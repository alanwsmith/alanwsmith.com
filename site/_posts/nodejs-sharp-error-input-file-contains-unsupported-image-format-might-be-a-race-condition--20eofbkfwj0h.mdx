---
blurb: An async file write was causing me issues with sharp. fs.writeFileSync
  got things working as expected.
categories:
  - Miscellaneous
date: 2021-11-04T17:01:17
id: 20eOfbkFwJ0h
scrubbed_2021: false
status: published
title: Nodejs sharp error - Input file contains unsupported image format might
  be a race condition
type: post
slug: nodejs-sharp-error-input-file-contains-unsupported-image-format-might-be-a-race-condition--20eofbkfwj0h
---

Was doing some S3 work where I had `fs.writeFile` that worked locally but not on the server. 

Realized that it was causing a race condition with sharp. 

Fix was to flip over to using `fs.writeFileSync` so the process didn't move on until the file was finished writing

- https://www.geeksforgeeks.org/node-js-fs-writefilesync-method/