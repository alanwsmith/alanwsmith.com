---
blurb: ''
categories:
  - AWS
date: '2021-10-04T22:28:03'
id: 20eOX8fR8NGY
scrubbed_2021: false
status: unpublished
type: post
title: AWS MFA Token Updator
slug: 20eOX8fR8NGY--aws-mfa-token-updator
---

I've got a couple of these, but this is the one I'm using as of October 4, 2021

```bash
#!/bin/bash

if [ $1 ]
then
  security add-generic-password \
    -a alans \
      -s password-key \
      -U -w $(aws sts --profile AWS_PROFILE get-session-token \
      --duration-seconds 129600 \
      --serial-number arn:aws:iam::12341234:mfa/AWS_NAME \
      --token-code $1 | jq -c '. | {Version: 1,AccessKeyId: .Credentials.AccessKeyId, SecretAccessKey: .Credentials.SecretAccessKey, SessionToken: .Credentials.SessionToken }')
  echo "Updated credentails"
      else
        echo "No token passed"
fi
```

Then, in the ~/.aws/credentails file

```bash
[default]
credential_process = security find-generic-password -w -a alans -s password-key
