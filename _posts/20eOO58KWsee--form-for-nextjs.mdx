---
blurb: ''
categories:
  - Miscellaneous
date: '2021-08-29T21:00:47'
id: 20eOO58KWsee
scrubbed_2021: false
status: unpublished
type: post
title: Form For NextJS
slug: 20eOO58KWsee--form-for-nextjs
---

This post is based off [this article](https://flaviocopes.com/nextjs-upload-files/) with some fleshed out details and showing how to access the data in the file. I tested this and it works on Netlify

make an app, then run:

```
npm install next-connect multiparty
```

---

./pages/index.js


```
export default function Home() {
  return (
    <>
      <form
        method="post"
        action="/api/receive-file"
        encType="multipart/form-data"
      >
        <input type="file" id="testFile" name="testFile" />
        <button type="submit">Upload</button>
      </form>
    </>
  );
}
```

---

./middleware/middleware.js

```
import nextConnect from 'next-connect'
import multiparty from 'multiparty'

const middleware = nextConnect()

middleware.use(async (req, res, next) => {
  const form = new multiparty.Form()

  await form.parse(req, function (err, fields, files) {
    req.body = fields
    req.files = files
    next()
  })
})

export default middleware
```

--------------------------------------------------------------------------------

./pages/api/receive-file.js

```
import middleware from "../../middleware/middleware";
import nextConnect from "next-connect";
const fs = require("fs");

const handler = nextConnect();
handler.use(middleware);

handler.post(async (req, res) => {
  console.log(req.body);
  console.log(req.files);
  const tmp_file_path = req.files["testFile"][0].path;
  try {
    const data = fs.readFileSync(tmp_file_path);
    res.json({ dataFromFile: data.toString() });
    console.log(data.toString());
  } catch (err) {
    console.log(err);
  }
});

export const config = {
  api: {
    bodyParser: false,
  },
};

export default handler;
```

More details on [multiparty](https://www.npmjs.com/package/multiparty)
